# 5-3 

## 처리능력이 부족하면 복수 서버로 부하 분산된다.

1. 서버 머신을 고성능 기종으로 교체하는 방법 (scale up)
   1. 다수의 사용자가 집중적으로 액세스하면 한대로는 따라잡지 못함
2. 복수의 서버를 사용하여 처리를 분담하여 한 대당 처리량을 줄이는 방법
   1. 분산처리 



- DNS서버에 같은 이름으로 여러대의 웹 서버 등록 
  - 라운드로빈
    - 차례대로 액세스, 주기마다 순환 방식
    - 웹서버의 고장을 확인하지 않고 그냥 IP주소를 회답함(요즘엔 브라우저가 다음 IP주소로 다시 시도하는 방식으로 해결하긴함 )
    - 웹서버가 변하면 대화가 도중에 끊기는 문제
      - 쇼핑몰에서 첫번째 페이지에서 주소나 성명을 입력하고 두 번째 페이지에서 신용카드 번호를 입력한다면 ?

**부하분산장치를 이용해 복수의 웹서버로 분할** 

- 로드밸런서, 부하분산장치
- 부하분산장치를 웹서버 대신 DNS 서버에 등록 



**대화가 복수의 페이지에 걸쳐있지 않다면**

- CPU, 메모리 상태 등을 수집해서 부하가 낮은 서버에 보냄

**대화가 복수의 페이지에 걸쳐있다면**

- 웹 서버와 관계없이 이전의 리퀘스트와 같은 웹 서버에 전송해야함 
- 근데 HTTP는 응답메시지 전송하면 TCP 연결을 끊음. 이전 클라이언트의 정보를 쿠키에 담거나,,HTTP 필드를 보고 복수의 페이지에 걸쳐있는지 확인해서 이전과 같은 웹서버에 요청을 전송하는 처리가 필요



# 5-4

## 캐시서버를 이용한 서버의 부하분산

- 프록시 구조를 사용해서 데이터를 캐시에 저장하는 서버 
- 프록시란
  - 웹서버와 클라이언트 사이에 들어가서 웹서버에 대한 액세스 동작을 중개하는 역할 
- 캐시
  - 웹서버에서 받은 데이터를 디스크에 저장해두고 웹 서버를 대신하여 데이터를 클라이언트에 반송
- 웹서버는 내부 처리 과정으로 클라이언트에 송신할 때 시간이 걸리는데, 캐시서버는 웹서버에서 받아 보존해둔 데이터를 읽어서 클라이언트에 송신만 하므로 웹서버보다 빨리 데이터를 송신할 수 있다. 



## 포워드 프록시

클라이언트측에 두는 프록시 구조 

- [사내 LAN에서 캐싱] 프록시에서 리퀘스트 메시지를 일단 받아서 인터넷을 향해 전송하면 필요한 것을 통과시킬 수 있다. 이전에 액세스한 페이지의 경우 사내 LAN에서 프록시에 액세스하기만 하면 데이터를 손에 넣을 수 있으므로 저속 회선에서 인터넷에 액세스하는 것보다 빨라질 것 

- [사전 필터링] 프록시는 요청의 내용을 조사한후 전송하므로 요청 내용에 따라 액세스가 가능한지 판단할 수 있다. 

- 브라우저 프록시 서버 항목에 포워드 프록시의 IP주소를 설정하고 리퀘스트를 전부 포워드프록시에게 보냄 
- 포워드 프록시는 URL이 그대로 전송 대상 . 서버측에 두는 프록시처럼 전송 대상을 사전에 설정해 둘 필요가 없음 

포워드 프록시를 사용할 경우 브라우저에 대한 설정이 필요한데 브라우저 설정이 번거롭고 잘못 설정할 경우 브라우저가 제대로 작동하지 않는 원인이 되기도함

```java
//추가
서버에서 받는 IP는 클라이언트가 아닌 프록시의 IP이므로 서버는 클라이언트가 누구인지 알 수 없다. 서버에게 클라이언트가 누구인지 감춰주는 역할을 한다. 
=> 기업 사내망에서 주로 사용됨
```

**포워드 프록시의 특징,역할**

- 캐싱 
  - 첫 요청 이후 동일한 요청에 대해 프록시 서버에 캐싱된 내용을 전달
- IP우회
  - 위에 적은 것처럼 서버 측에 클라이이언트의 정보를 숨김
- 제한
  - 보안이 중요한 사내망에서 정해진 사이트에만 연결할 수 있도록 설정하는 등 웹 사용 환경을 제한함



### 리버스 프록시

포워드 프록시와 반대개념으로 어플리케이션 서버 앞에 위치하여 클라이언트가 서버를 요청할 때 리버스 프록시를 호출하고, 리버스 프록시가 서버로부터 응답을 전달받아 다시 클라이언트에게 전송하는 역할을 한다.   

클라이언트는 어플리케이션 서버를 직접 호출하는 것이 아니라 프록시 서버를 통해 호출하기 때문에 리버스 프록시는 클라이언트로부터 애플리케이션 서버를 감추는 역할을 하게된다.

- 예시
  - nginx, 아파치 웹서버

**리버스 프록시의 특징, 역할**

- 로드밸런싱
  - 리버스 프록시 뒤에 여러개의 WAS를 둠으로써 사용자 요청을 분산 , 트래픽 분산
- 보안
  - 보안상의 이유로 서버에 직접 접근하는 것을 막기 위해 DMZ같은 네트워크에 리버스 프록시를 구성하여 접근하도록 함 



![img](https://blog.kakaocdn.net/dn/cCCaWL/btrgHEnkfmj/t4buTmkGSnxLPhAse8CL91/img.png)  
출저 : https://pin.it/2aVNvlQ

- 참고
  - https://sujinhope.github.io/2021/06/13/Network-%ED%94%84%EB%A1%9D%EC%8B%9C(Proxy)%EB%9E%80,-Forward-Proxy%EC%99%80-Reverse-Proxy.html

## 콘텐츠 배포 서비스

- 웹 서버의 직전에 캐시 서버를 두는 경우
  - 웹서버의 부하 억제 효과 O
  - 인터넷 트래픽 억제 효과 X 
- 클라이언트 측에 캐시 서버를 두는 겨우
  - 인터넷 트래픽 억제 효과 O
  - 서버 운영자가 캐시 서버 제어 불가능
- 인터넷의 주위에 캐시 서버를 두는 경우
  - 인터넷 트래픽 억제 효과 O
  - 서버 운영자가 캐시 서버 제어 가능 



하지만 인터넷에 공개하는 서버는 인터넷의 어디에서 액세스하는지 알 수 없다. 

이때 나온 개념으로 캐시 서버를 설치하고 웹 서버 운영자에게 대출하는 서비스를 제공하는 사업자가 등장했는데 이런 종류의 서비스를 **콘텐츠 배포 서비스**라고 한다. 

CDSP는 프로바이더와 계약하고 그곳에 다수의 캐시 서버를 설치한다. 또한 웹 서버 운영자와도 계약하여 웹 서버와 CDSP의 캐시 서버를 연대시킨다. 

DNS서버와 가장 가까운 캐시 서버 를 응답 (거리 미리 계산해두고)  또는 리다이렉트로 가까운 서버를 다시 알려줌             